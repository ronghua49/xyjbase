<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<script src="../js/flexible100.js"></script>
		<title>充值卡赠送</title>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			
			body {
				background: #e54216;
			}
			
			.coupons {
				height: 100%;
				background: #e54216;
				overflow: auto;
			}
			
			header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0 .26rem;
				height: .88rem;
				box-sizing: border-box;
				background: #e54216;
				position: fixed;
				width: 100%;
			}
			
			header>span {
				width: 33%;
			}
			
			header>div {
				width: 33%;
				display: inline-block;
				text-align: center;
				font-size: .3rem;
				color: white;
				font-family: "微软雅黑";
			}
			
			.banner {
				width: 100%;
				vertical-align: middle;
				margin-top: 1.05rem;
			}
			
			.phone,
			.code {
				display: block;
				margin: .5rem auto;
				width: 6.4rem;
				height: .8rem;
				border: 1px solid #f4f4f7;
				outline: none;
				background: white;
				box-sizing: border-box;
				font-size: .28rem;
				border-radius: .04rem;
			}
			
			input {
				padding-left: .15rem;
			}
			
			.code {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}
			
			.code input {
				width: 70%;
				height: .8rem;
				border: none;
				outline: none;
			}
			
			.code button {
				width: 25%;
				height: .8rem;
				background: #fb2330;
				border: none;
				outline: none;
				color: white;
				margin-right: -.1rem;
			}
			
			.code button:active {
				background: #e24014;
			}
			
			.get {
				width: 6.4rem;
				height: .8rem;
				margin: .82rem auto 0;
				display: block;
				background: #e54216;
				border: none;
				outline: none;
				color: #fff;
				margin-bottom: .8rem;
				border-radius: .04rem;
				font-size: .32rem;
				box-shadow: 0 0 10px 2px rgba(0, 0, 0, .15);
			}
			.get:active {
				background: #e24014;
			}
			.card {
				padding: .32rem .4rem;
				box-sizing: border-box;
				background: url('../img/cards_img.png') no-repeat 100% / 100%;
				width: 7rem;
				height: 2.56rem;
				color: white;
				box-shadow: 0 0 10px 2px rgba(0, 0, 0, .15);
				margin: 2rem auto 1rem;
			}
			
			.name {
				font-size: .3rem;
			}
			
			.type {
				margin: .1rem 0;
				font-size: .3rem;
			}
			
			.card>.clearfix {
				height: .22rem;
				padding: .15rem 0;
				border-top: 1px solid #fe724d;
				font-size: .28rem;
			}
			.clearfix:after{
				content: '';
				display: block;
				clear: both;
			}
			.fl{
				float: left;
			}
			.fr{
				float: right;
			}
			.cardName{
				display: block;
				margin-bottom: .1rem;
			}
		</style>
	</head>

	<body>
		<div class="coupons">
			<header>
				<span></span>
				<div>优惠券分享</div>
				<span></span>
			</header>
			<div class="card">
				<div>
					<div class="name">您的好友 王迪 为您分享：</div>
					<div class="type">
						<span class="cardName">汽油92# 50升</span>
						<div class="clearfix">
							<span class="fl">面值￥500.00元</span>
							<span class="fr">x1</span>
						</div>
					</div>
					
				</div>
				<div class="clearfix">
					<span class="fl">自主生成</span>
					<span class="time fr gift_time">2018-12-21 15:57:42</span>
				</div>
			</div>
		</div>
		<input type="text" class="phone" placeholder="请输入您的手机号码" maxlength="11" />
		<div class="code">
			<input type="text" placeholder="请输入验证码" maxlength="8" class="codeInp"/>
			<button type="button" class="getCode">获取验证码</button>
		</div>
		<button class="get">领取充值卡</button>
	</body>
	<script src="../js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/xyjApp.js" type="text/javascript" charset="utf-8"></script>
	<script>
		$("input").on('input', function() {
			var val = $(this).val();
			$(this).val($.trim(val))
			if(isNaN(val)) {
				if(val.length >= 2) {
					$(this).val(parseInt(val));
				} else {
					$(this).val("");
				}
			}
		});
		var time = null,
			num = 60;
		var codeUrl = "http://39.105.40.60:6008/appUser/getVerificationCode/";
		getCodeFn();

		function getCodeFn() {
			$(".getCode").on('click', function() {
				if ( !$(".phone").val() ) {
					xyjApp.toast('手机号码不能为空!')
					return;
				}
				if ( !/^1(3|5|7|8|9)\d{9}$/.test($(".phone").val()) ) {
					xyjApp.toast('手机号码格式不正确！')
					return;
				}
				$(this).attr('disabled', 'disabled');
				clearInterval(time);
				var url = codeUrl + $(".phone").val() + '/1';
				xyjApp.ajax(url, 'get', {}, function(data) {
					if(data.hasOwnProperty('error')) {
						xyjApp.toast('系统错误');
						return;
					}
					time = setInterval(function() {
						if(num == -1) {
							clearInterval(time);
							num = 60;
							$(".getCode").removeAttr('disabled').text('重新获取');
							getCodeFn();
						}
						num--;
						$(".getCode").text(num + 's');
					}, 1000);
				})
			});
		}
		var id = location.search.slice(1).split("&")[0].split("=")[1];
		var url = "http://39.105.40.60:6008/appUserCardAccount/getGiftInfo/" + id;
		xyjApp.ajax(url, 'get', {}, function(data) {
			if(data.hasOwnProperty('error')) {
				xyjApp.toast('系统错误');
				return;
			}
			var res = data.data
			for ( var key in res ) {
				if ( $("."+key).length == 1 ) {
					$("."+key).text(res[key]);
				}
			}
		});
		$(".get").on('click', function() {
			if ( !$(".phone").val() ) {
				xyjApp.toast('手机号码不能为空!');
				return;
			}
			if ( !/^1(3|5|7|8|9)\d{9}$/.test($(".phone").val()) ) {
				xyjApp.toast('手机号码格式不正确！')
				return;
			}
			if ( !$(".codeInp").val() ) {
				xyjApp.toast('验证码不能为空!')
				return;
			}
			var str = "id="+id+"&phone="+$.trim($(".phone").val())+"&yzm="+$.trim($(".codeInp").val());
			var url1 = "http://39.105.40.60:6008/appUserCardAccount/CollectCardAccount?"+str;
			xyjApp.ajax(url1, 'post', {}, function(data) {
				if(data.hasOwnProperty('error')) {
					xyjApp.toast('系统错误');
					return;
				}
				xyjApp.toast('领取成功,快去下载好嗨油App,享受优惠吧!');
				setTimeout(function(){
					location.href = "http://qp.19n.com/static/other/html/downloadApp.html";
				},800);
			})
		})
	</script>

</html>